
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deice Verbiage Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="style.css" rel="stylesheet" />
<style>body { font-family: "Segoe UI", Tahoma, sans-serif; background: #f4f7fa; margin: 0; padding: 20px; text-align: center; }#app { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }select, button, input[type="checkbox"] { padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; margin: 10px 0; }#start-button { background: #007bff; color: white; border: none; cursor: pointer; transition: background 0.3s; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; display: inline-flex; align-items: center; justify-content: center; }#start-button:hover { background: #0056b3; }#hints, #score, #score-history, #instructor-log { margin-top: 20px; text-align: left; }table { width: 100%; border-collapse: collapse; font-size: 14px; }th, td { padding: 8px; border: 1px solid #ddd; }.highlight-correct { background-color: #d4edda; }.highlight-missing { background-color: #fff3cd; }.highlight-incorrect { background-color: #f8d7da; }</style></head>
<body><div id="app">
  <div class="container">
    <header>
      <h1>Deice Verbiage Trainer</h1>
      <p>Select a scenario and respond with your voice</p>
    </header>

    <section class="card">
      <label for="scenario">Scenario</label>
      <select id="scenario">
  <option value="type1">Anti-Ice Type I</option>
  <option value="type4">Anti-Ice Type IV</option>
  <option value="dual">Dual Fluid Application</option>
  <option value="request">Request to Deice</option>
  <option value="complete">Deicing Complete</option>
  <option value="pad_ready">Notify Pad Ready</option>
  <option value="temp_alert">Temperature Alert</option>
  <option value="confirm_equipment_clear">Confirm Equipment Clear</option>
  <option value="holdover_expired">Holdover Time Expired</option>
</select>
<div id="hints" style="margin-top:10px; font-style: italic; color: #555;"></div>
<div id="score-history" style="margin-top:15px;"><strong>Your Scores:</strong><br><ul id="score-list"></ul></div>
<label style="margin-top:20px; display:block;"><input type="checkbox" id="instructorMode"> Instructor Mode</label>
<div id="instructor-log" style="display:none; margin-top:10px;"><strong>Instructor Log:</strong><br><table border="1" cellpadding="5" style="border-collapse:collapse;width:100%"><thead><tr><th>Date</th><th>Scenario</th><th>Score</th><th>User Response</th></tr></thead><tbody id="log-body"></tbody></table></div>
      <button onclick="startScenario()">ðŸŽ¤ Start Scenario</button>
    </section>

    <section class="card">
      <p><strong>Prompt:</strong> <span id="prompt-text"></span></p>
      <p><strong>Expected:</strong> <span id="expected-text"></span></p>
      <p><strong>You Said:</strong> <span id="spoken-text"></span></p>
      
    <div id="mic-status" class="mic-status" style="display:none;">
      <img src="mic.png" alt="Listening..." width="48" />
      <p>Listening...</p>
    </div>
    <div id="score" class="score"></div>
    
      <div id="missing" class="missing"></div>
    </section>
  </div>

  <script>
    const scenarios = {
      type1: {
        prompt: "Inform flight deck Type I was used as final step.",
        expected: "Captain, you have been anti-iced with Type I Cryotech Polar Plus LT, starting at 13:48. Post deicing/anti-icing check complete, deicing personnel and equipment are safely away."
      },
      type4: {
        prompt: "Inform flight deck of Type IV application including time and brand.",
        expected: "Captain, you have been anti-iced with Type IV, Cryotech Polar Guard X-Tend, at 100%, starting at 13:48. Post deicing/anti-icing check complete, deicing personnel and equipment are safely away."
      },
      dual: {
        prompt: "Inform flight deck of dual application Type I and Type IV.",
        expected: "Captain, you have been deiced with Type I Cryotech Polar Plus LT, followed by anti-icing with Type IV Cryotech Polar Guard X-Tend at 100%, completed at 13:48. Post deicing/anti-icing check complete, personnel and equipment clear."
      },
      request: {
        prompt: "Request permission to deice.",
        expected: "Captain, request permission to deice due to contamination present on critical surfaces."
      },
      complete: {
        prompt: "Announce completion of deicing and clear zone.",
        expected: "Captain, deicing and anti-icing operations are complete. All personnel and equipment are clear of the aircraft."
      },
      pad_ready: {
        prompt: "Notify captain pad is ready for deice.",
        expected: "Captain, the deice pad is ready. You are cleared to enter when ready."
      },
      temp_alert: {
        prompt: "Notify flight deck of temperature change affecting holdover.",
        expected: "Captain, be advised the ambient temperature has dropped. Updated holdover time is being recalculated."
      },
      confirm_equipment_clear: {
        prompt: "Confirm all equipment is clear from aircraft.",
        expected: "Captain, all deicing equipment and personnel are clear from the aircraft. You are good to taxi."
      },
      holdover_expired: {
        prompt: "Notify captain holdover time has expired.",
        expected: "Captain, your holdover time has expired. We will need to reapply anti-icing fluid before departure."
      }
    };

    const synth = window.speechSynthesis;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

    let currentScenario;

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = [...synth.getVoices()].find(v => v.name.includes("Samantha") || v.name.includes("Google US")) || synth.getVoices()[0];
      synth.speak(utter);
    }

    function startScenario() {
      const selected = document.getElementById("scenario").value;
      currentScenario = scenarios[selected];
      document.getElementById("prompt-text").textContent = currentScenario.prompt;
      document.getElementById("expected-text").textContent = currentScenario.expected;
      speak(currentScenario.prompt);
      document.getElementById('mic-status').style.display = 'block'; recognition.start();

      recognition.onresult = function(event) {
  document.getElementById('mic-status').style.display = 'none';
        const spokenText = event.results[0][0].transcript;
        document.getElementById("spoken-text").textContent = spokenText;
        evaluate(spokenText);
      };
    }

    function evaluate(spoken) {
      const expected = currentScenario.expected.toLowerCase().split(" ");
      const actual = spoken.toLowerCase().split(" ");
      let matchCount = 0;
      let missingWords = [];

      expected.forEach(word => {
        if (actual.includes(word)) {
          matchCount++;
        } else {
          missingWords.push(word);
        }
      });

      const score = Math.round((matchCount / expected.length) * 100);
  logAttempt(currentScenario.label, score, spoken);
  updateScoreHistory(currentScenario.label, score);
      document.getElementById("score").textContent = `Score: ${score}%`;

      const highlighted = expected.map(word =>
        actual.includes(word) ? word : `<span class="highlight">${word}</span>`
      ).join(" ");
      document.getElementById("missing").innerHTML = `Expected: ${highlighted}`;
    }

    window.onload = () => synth.getVoices();
  
document.getElementById("scenario").addEventListener("change", function () {
  const selected = this.value;
  const scenario = scenarios.find(s => s.id === selected);
  if (scenario) {
    const hintText = scenario.expected.split(" ").slice(0, 4).join(" ");
    document.getElementById("hints").innerText = "Hint: say something like \"" + hintText + "...\"";
  }
});


function updateScoreHistory(label, score) {
  let scores = JSON.parse(localStorage.getItem("scenarioScores")) || {};
  scores[label] = score;
  localStorage.setItem("scenarioScores", JSON.stringify(scores));
  renderScoreHistory();
}

function renderScoreHistory() {
  let scores = JSON.parse(localStorage.getItem("scenarioScores")) || {};
  const list = Object.entries(scores)
    .map(([scenario, score]) => `<li><strong>${scenario}:</strong> ${score}%</li>`)
    .join("");
  document.getElementById("score-list").innerHTML = list;
}

window.onload = function () {
  renderScoreHistory();
};


function logAttempt(label, score, response) {
  let log = JSON.parse(localStorage.getItem("instructorLog")) || [];
  log.push({
    date: new Date().toLocaleString(),
    scenario: label,
    score: score,
    response: response
  });
  localStorage.setItem("instructorLog", JSON.stringify(log));
  renderInstructorLog();
}

function renderInstructorLog() {
  const enabled = document.getElementById("instructorMode").checked;
  document.getElementById("instructor-log").style.display = enabled ? "block" : "none";

  if (!enabled) return;

  let log = JSON.parse(localStorage.getItem("instructorLog")) || [];
  const rows = log.map(entry =>
    `<tr><td>${entry.date}</td><td>${entry.scenario}</td><td>${entry.score}%</td><td>${entry.response}</td></tr>`
  ).join("");
  document.getElementById("log-body").innerHTML = rows;
}

document.getElementById("instructorMode").addEventListener("change", renderInstructorLog);

</script>
</div></body>
</html>
